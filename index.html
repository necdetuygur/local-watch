<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocalWatch</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@200;300;400;500;600;700;800;900;1000&display=swap");

      body,
      table,
      input {
        font-family: "JetBrains Mono", "Courier New", Courier, monospace;
      }
    </style>
    <script src="nocket.js"></script>
  </head>
  <body>
    <div
      style="margin: 10px; padding: 10px; background-color: #000; color: #fff"
    >
      LocalWatch
    </div>
    <div
      style="margin: 10px; padding: 10px; background-color: #eee; color: #000"
    >
      I:
      <input
        type="text"
        id="id"
        readonly
        style="margin-bottom: 10px; padding: 10px; width: 90%"
      />
      <br />
      U:
      <input
        type="text"
        id="send"
        style="margin-bottom: 10px; padding: 10px; width: 90%"
      />
      <br />
      V:
      <input
        type="file"
        id="file"
        style="margin-bottom: 10px; padding: 10px; width: 90%"
      />
      <br />
      <input
        type="button"
        id="sync"
        style="margin-bottom: 10px; padding: 10px; width: 100%"
      />
      <video
        id="video"
        width="100%"
        height="300"
        style="width: 100%; height: 300px; display: none"
        controls
      ></video>
    </div>

    <script>
      const idEl = document.getElementById("id");
      const sendEl = document.getElementById("send");
      const file = document.getElementById("file");
      const video = document.getElementById("video");
      const sync = document.getElementById("sync");

      const send = () => {
        if (!sendEl.value) return;
        const data = {
          time: video.currentTime,
          play: video.paused ? 0 : 1,
          speed: video.playbackRate,
        };
        Nocket.Send(sendEl.value, data);
      };

      file.addEventListener("change", function () {
        video.src = URL.createObjectURL(this.files[0]);
        video.playbackRate = 1.25;
        video.style.display = "block";
      });

      sync.addEventListener("click", function () {
        send();
      });

      window.addEventListener("load", () => {
        setTimeout(() => {
          Nocket.Listen((data) => {
            data.time = parseFloat(data.time);
            data.play = data.play == 1;
            data.speed = parseFloat(data.speed);

            console.log(data.time + "\n" + data.play + "\n" + data.speed);

            video.currentTime = parseFloat(data.time);
            data.play ? video.play() : video.pause();
            video.playbackRate = parseFloat(data.speed);
          });
          idEl.value = Nocket.ID;
        }, 1e3);
      });
    </script>
  </body>
</html>
